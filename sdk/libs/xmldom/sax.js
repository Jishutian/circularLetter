function XMLReader(){}function parse(e,t,r,a,n){function s(e){if(e>65535){e-=65536;var t=55296+(e>>10),r=56320+(1023&e);return String.fromCharCode(t,r)}return String.fromCharCode(e)}function i(e){var t=e.slice(1,-1);return t in r?r[t]:"#"===t.charAt(0)?s(parseInt(t.substr(1).replace("x","0x"))):(n.error("entity not found:"+e),e)}function c(t){if(t>S){var r=e.substring(S,t).replace(/&#?\w+;/g,i);m&&u(S),a.characters(r,0,t-S),S=t}}function u(t,r){for(;t>=l&&(r=f.exec(e));)o=r.index,l=o+r[0].length,m.lineNumber++;m.columnNumber=t-o+1}for(var o=0,l=0,f=/.+(?:\r\n?|\n)|.*$/g,m=a.locator,p=[{currentNSMap:t}],d={},S=0;;){try{var _=e.indexOf("<",S);if(_<0){if(!e.substr(S).match(/^\s*$/)){var h=a.document,g=h.createTextNode(e.substr(S));h.appendChild(g),a.currentElement=g}return}switch(_>S&&c(_),e.charAt(_+1)){case"/":var w=e.indexOf(">",_+3),b=e.substring(_+2,w),x=p.pop(),T=x.localNSMap;if(x.tagName!=b&&n.fatalError("end tag name: "+b+" is not match the current start tagName:"+x.tagName),a.endElement(x.uri,x.localName,b),T)for(var v in T)a.endPrefixMapping(v);w++;break;case"?":m&&u(_),w=parseInstruction(e,_,a);break;case"!":m&&u(_),w=parseDCC(e,_,a,n);break;default:m&&u(_);var N=new ElementAttributes,E=(w=parseElementStartPart(e,_,N,i,n),N.length);if(m){if(E)for(var A=0;A<E;A++){var C=N[A];u(C.offset),C.offset=copyLocator(m,{})}u(w)}!N.closed&&fixSelfClosed(e,w,N.tagName,d)&&(N.closed=!0,r.nbsp||n.warning("unclosed xml attribute")),appendElement(N,a,p),"http://www.w3.org/1999/xhtml"!==N.uri||N.closed?w++:w=parseHtmlSpecialContent(e,w,N.tagName,i,a)}}catch(e){n.error("element parse error: "+e),w=-1}w>S?S=w:c(Math.max(_,S)+1)}}function copyLocator(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function parseElementStartPart(e,t,r,a,n){for(var s,i=++t,c=S_TAG;;){var u=e.charAt(i);switch(u){case"=":if(c===S_ATTR)s=e.slice(t,i),c=S_EQ;else{if(c!==S_ATTR_S)throw new Error("attribute equal must after attrName");c=S_EQ}break;case"'":case'"':if(c===S_EQ){if(t=i+1,i=e.indexOf(u,t),!(i>0))throw new Error("attribute value no end '"+u+"' match");o=e.slice(t,i).replace(/&#?\w+;/g,a),r.add(s,o,t-1),c=S_E}else{if(c!=S_V)throw new Error('attribute value must after "="');o=e.slice(t,i).replace(/&#?\w+;/g,a),r.add(s,o,t),n.warning('attribute "'+s+'" missed start quot('+u+")!!"),t=i+1,c=S_E}break;case"/":switch(c){case S_TAG:r.setTagName(e.slice(t,i));case S_E:case S_S:case S_C:c=S_C,r.closed=!0;case S_V:case S_ATTR:case S_ATTR_S:break;default:throw new Error("attribute invalid close char('/')")}break;case"":n.error("unexpected end of input");case">":switch(c){case S_TAG:r.setTagName(e.slice(t,i));case S_E:case S_S:case S_C:break;case S_V:case S_ATTR:o=e.slice(t,i),"/"===o.slice(-1)&&(r.closed=!0,o=o.slice(0,-1));case S_ATTR_S:c===S_ATTR_S&&(o=s),c==S_V?(n.warning('attribute "'+o+'" missed quot(")!!'),r.add(s,o.replace(/&#?\w+;/g,a),t)):(n.warning('attribute "'+o+'" missed value!! "'+o+'" instead!!'),r.add(o,o,t));break;case S_EQ:throw new Error("attribute value missed!!")}return i;case"":u=" ";default:if(u<=" ")switch(c){case S_TAG:r.setTagName(e.slice(t,i)),c=S_S;break;case S_ATTR:s=e.slice(t,i),c=S_ATTR_S;break;case S_V:var o=e.slice(t,i).replace(/&#?\w+;/g,a);n.warning('attribute "'+o+'" missed quot(")!!'),r.add(s,o,t);case S_E:c=S_S}else switch(c){case S_ATTR_S:n.warning('attribute "'+s+'" missed value!! "'+s+'" instead!!'),r.add(s,s,t),t=i,c=S_ATTR;break;case S_E:n.warning('attribute space is required"'+s+'"!!');case S_S:c=S_ATTR,t=i;break;case S_EQ:c=S_V,t=i;break;case S_C:throw new Error("elements closed character '/' and '>' must be connected to")}}i++}}function appendElement(e,t,r){for(var a=e.tagName,n=null,s=r[r.length-1].currentNSMap,i=e.length;i--;){var c=e[i],u=c.qName,o=c.value,l=u.indexOf(":");if(l>0)var f=c.prefix=u.slice(0,l),m=u.slice(l+1),p="xmlns"===f&&m;else m=u,f=null,p="xmlns"===u&&"";c.localName=m,!1!==p&&(null==n&&(n={},_copy(s,s={})),s[p]=n[p]=o,c.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(p,o))}for(i=e.length;i--;){c=e[i];f=c.prefix;f&&("xml"===f&&(c.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==f&&(c.uri=s[f]))}l=a.indexOf(":");l>0?(f=e.prefix=a.slice(0,l),m=e.localName=a.slice(l+1)):(f=null,m=e.localName=a);var d=e.uri=s[f||""];if(t.startElement(d,m,a,e),e.closed){if(t.endElement(d,m,a),n)for(f in n)t.endPrefixMapping(f)}else e.currentNSMap=s,e.localNSMap=n,r.push(e)}function parseHtmlSpecialContent(e,t,r,a,n){if(/^(?:script|textarea)$/i.test(r)){var s=e.indexOf("</"+r+">",t),i=e.substring(t+1,s);if(/[&<]/.test(i))return/^script$/i.test(r)?(n.characters(i,0,i.length),s):(i=i.replace(/&#?\w+;/g,a),n.characters(i,0,i.length),s)}return t+1}function fixSelfClosed(e,t,r,a){var n=a[r];return null==n&&(n=a[r]=e.lastIndexOf("</"+r+">")),n<t}function _copy(e,t){for(var r in e)t[r]=e[r]}function parseDCC(e,t,r,a){var n=e.charAt(t+2);switch(n){case"-":if("-"===e.charAt(t+3)){var s=e.indexOf("-->",t+4);return s>t?(r.comment(e,t+4,s-t-4),s+3):(a.error("Unclosed comment"),-1)}return-1;default:if("CDATA["==e.substr(t+3,6)){s=e.indexOf("]]>",t+9);return r.startCDATA(),r.characters(e,t+9,s-t-9),r.endCDATA(),s+3}var i=split(e,t),c=i.length;if(c>1&&/!doctype/i.test(i[0][0])){var u=i[1][0],o=c>3&&/^public$/i.test(i[2][0])&&i[3][0],l=c>4&&i[4][0],f=i[c-1];return r.startDTD(u,o&&o.replace(/^(['"])(.*?)\1$/,"$2"),l&&l.replace(/^(['"])(.*?)\1$/,"$2")),r.endDTD(),f.index+f[0].length}}return-1}function parseInstruction(e,t,r){var a=e.indexOf("?>",t);if(a){var n=e.substring(t,a).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(n){n[0].length;return r.processingInstruction(n[1],n[2]),a+2}return-1}return-1}function ElementAttributes(e){}function _set_proto_(e,t){return e.__proto__=t,e}function split(e,t){var r,a=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(n.lastIndex=t,n.exec(e);r=n.exec(e);)if(a.push(r),r[1])return a}var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"·̀-ͯ\\u203F-⁀]"),tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$"),S_TAG=0,S_ATTR=1,S_ATTR_S=2,S_EQ=3,S_V=4,S_E=5,S_S=6,S_C=7;XMLReader.prototype={parse:function(e,t,r){var a=this.domBuilder;a.startDocument(),_copy(t,t={}),parse(e,t,r,a,this.errorHandler),a.endDocument()}},ElementAttributes.prototype={setTagName:function(e){if(!tagNamePattern.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,r){if(!tagNamePattern.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:r}},length:0,getLocalName:function(e){return this[e].localName},getOffset:function(e){return this[e].offset},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},_set_proto_({},_set_proto_.prototype)instanceof _set_proto_||(_set_proto_=function(e,t){function r(){}for(t in r.prototype=t,r=new r,e)r[t]=e[t];return r}),"function"==typeof require&&(exports.XMLReader=XMLReader);