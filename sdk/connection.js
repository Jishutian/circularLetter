function _listenNetwork(e,t){window.addEventListener?(window.addEventListener("online",e),window.addEventListener("offline",t)):window.attachEvent&&(document.body?(document.body.attachEvent("ononline",e),document.body.attachEvent("onoffline",t)):window.attachEvent("load",function(){document.body.attachEvent("ononline",e),document.body.attachEvent("onoffline",t)}))}function _parseRoom(e){var t=[],o=e.getElementsByTagName("item");if(o)for(let e=0;e<o.length;e++){let n=o[e],i=n.getAttribute("jid"),r=i.split("@")[0],s={jid:i,name:n.getAttribute("name"),roomId:r.split("_")[1]};t.push(s)}return t}function _parseRoomOccupants(e){var t=[],o=e.getElementsByTagName("item");if(o)for(let e=0;e<o.length;e++){let n=o[e],i={jid:n.getAttribute("jid"),name:n.getAttribute("name")};t.push(i)}return t}function _parseResponseMessage(msginfo){var parseMsgData={errorMsg:!0,data:[]},msgBodies=msginfo.getElementsByTagName("body");if(msgBodies){for(let e=0;e<msgBodies.length;e++){let t=msgBodies[e],o=t.childNodes;if(o&&o.length>0){let e=t.childNodes[0];if(e.nodeType==Strophe.ElementType.TEXT){let t=e.wholeText||e.nodeValue;t=t.replace("\n","<br>");try{let e=JSON.parse(t);parseMsgData.errorMsg=!1,parseMsgData.data=[e]}catch(e){}}}}let e=msginfo.getElementsByTagName("delay");if(e&&e.length>0){let t=e[0],o=t.getAttribute("stamp");o&&(parseMsgData.delayTimeStamp=o)}}else{let childrens=msginfo.childNodes;if(childrens&&childrens.length>0){let child=msginfo.childNodes[0];if(child.nodeType==Strophe.ElementType.TEXT)try{let data=eval("("+child.nodeValue+")");parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(e){}}}return parseMsgData}function _parseNameFromJidFn(e,t){var o=e,n=o.indexOf("_");t=t||"",-1!==n&&(o=o.substring(n+1));let i=o.indexOf("@"+t);return-1!==i&&(o=o.substring(0,i)),o}function _parseFriend(e,t,o){var n=[],i=e.getElementsByTagName("item");if(i){for(let e=0;e<i.length;e++){let o=[],r=i[e],s=r.getAttribute("jid");if(!s)continue;let a=r.getAttribute("subscription"),c={subscription:a,jid:s},l=r.getAttribute("ask");l&&(c.ask=l);let p=r.getAttribute("name");c.name=p||_parseNameFromJidFn(s),Strophe.forEachChild(r,"group",function(e){o.push(Strophe.getText(e))}),c.groups=o,n.push(c),t&&"from"==a&&t.subscribe({toJid:s}),t&&"to"==a&&t.subscribed({toJid:s})}}return n}function _parseMessageType(e){var t="normal",o=e.getElementsByTagName("received");if(o&&o.length>0&&"urn:xmpp:receipts"===o[0].namespaceURI)t="received";else{let o=e.getElementsByTagName("invite");o&&o.length>0&&(t="invite")}return t}function _handleMessageQueue(e){for(let t in _msgHash)Object.hasOwnProperty.call(_msgHash,t)&&_msgHash[t].send(e)}function _loginCallback(e,t,o){var n,i="conflict"===t;if(e==Strophe.Status.CONNFAIL)n={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:t},i&&(n.conflict=!0),o.onError(n);else if(e==Strophe.Status.ATTACHED||e==Strophe.Status.CONNECTED){o.autoReconnectNumTotal=0,o.intervalId=setInterval(function(){o.handelSendQueue()},200);let e=function(e){var t=_parseMessageType(e);return"received"===t?(o.handleReceivedMessage(e),!0):"invite"===t?(o.handleInviteMessage(e),!0):(o.handleMessage(e),!0)},t=function(e){return o.handlePresence(e),!0},n=function(e){return o.handleIqRoster(e),!0},i=function(e){return o.handleIqPrivacy(e),!0},r=function(e){return o.handleIq(e),!0};o.addHandler(e,null,"message",null,null,null),o.addHandler(t,null,"presence",null,null,null),o.addHandler(n,"jabber:iq:roster","iq","set",null,null),o.addHandler(i,"jabber:iq:privacy","iq","set",null,null),o.addHandler(r,null,"iq",null,null,null),o.context.status=_code.STATUS_OPENED;let s=[_code.WEBIM_MESSAGE_REC_TEXT,_code.WEBIM_MESSAGE_REC_EMOJI],a=[_code.WEBIM_MESSAGE_SED_TEXT];_utils.isCanDownLoadFile&&(s.push(_code.WEBIM_MESSAGE_REC_PHOTO),s.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE)),_utils.isCanUploadFile&&(a.push(_code.WEBIM_MESSAGE_REC_PHOTO),a.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE)),o.notifyVersion(),o.retry&&_handleMessageQueue(o),o.heartBeat(),o.isAutoLogin&&o.setPresence(),o.onOpened({canReceive:s,canSend:a,accessToken:o.context.accessToken})}else e==Strophe.Status.DISCONNECTING?(o.isOpened()&&(n={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:t},i&&(n.conflict=!0),o.onError(n)),o.context.status=_code.STATUS_CLOSING):e==Strophe.Status.DISCONNECTED?(o.isOpened()&&(n={type:_code.WEBIM_CONNCTION_DISCONNECTED},o.onError(n)),o.context.status=_code.STATUS_CLOSED,o.clear(),o.onClosed()):e==Strophe.Status.AUTHFAIL?(n={type:_code.WEBIM_CONNCTION_AUTH_ERROR},i&&(n.conflict=!0),o.onError(n),o.clear(),wx.closeSocket()):e==Strophe.Status.ERROR&&(o.context.status=_code.STATUS_ERROR,n={type:_code.WEBIM_CONNCTION_SERVER_ERROR},i&&(n.conflict=!0),o.onError(n))}function _login(e,t){function o(e,o){console.log("connection stat change",e,o),_loginCallback(e,o,t)}var n=null,i=e.access_token||"";""!=i?(t.context.accessToken=e.access_token,t.context.accessTokenExpires=e.expires_in,n=new Strophe.Connection(t.url,{inactivity:t.inactivity,maxRetries:t.maxRetries,pollingTime:t.pollingTime}),t.context.stropheConn=n,t.route?n.connect(t.context.jid,"$t$"+i,o,t.wait,t.hold,t.route):n.connect(t.context.jid,"$t$"+i,o,t.wait,t.hold)):t.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:e})}function _getJid(e,t){var o=e.toJid||"";if(""===o){let n=t.context.appKey||"",i=n+"_"+e.to+"@"+t.domain;e.resource&&(i=i+"/"+e.resource),o=i}return o}function _getJidByName(e,t){return _getJid({to:e},t)}function _validCheck(e,t){if(e=e||{},""==e.user)return t.onError({type:_code.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR}),!1;let o=e.user+""||"",n=e.appKey||"",i=n.split("#");if(2!==i.length)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;let r=i[0],s=i[1];if(!r)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;if(!s)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;let a=n+"_"+o.toLowerCase()+"@"+t.domain,c=e.resource||"webim";return t.isMultiLoginSessions&&(c+=o+(new Date).getTime()+Math.floor(1e6*Math.random().toFixed(6))),t.context.jid=a+"/"+c,t.context.userId=o,t.context.appKey=n,t.context.appName=s,t.context.orgName=r,!0}function _getXmppUrl(e,t){if(/^(ws|http)s?:\/\/?/.test(e))return e;let o={prefix:"http",base:"://"+e,suffix:"/http-bind/"};return t&&_utils.isSupportWss?(o.prefix="wss",o.suffix="/ws/"):t?o.prefix="https":window.WebSocket&&(o.prefix="ws",o.suffix="/ws/"),o.prefix+o.base+o.suffix}function connection(e){if(!(this instanceof connection))return new connection(e);e=e||{},this.isMultiLoginSessions=e.isMultiLoginSessions||!1,this.wait=e.wait||30,this.retry=e.retry||!1,this.https=e.https||"https:"===location.protocol,this.url=_getXmppUrl(e.url,this.https),this.hold=e.hold||1,this.route=e.route||null,this.domain=e.domain||"easemob.com",this.inactivity=e.inactivity||30,this.heartBeatWait=e.heartBeatWait||4500,this.maxRetries=e.maxRetries||5,this.isAutoLogin=!1!==e.isAutoLogin,this.pollingTime=e.pollingTime||800,this.stropheConn=!1,this.autoReconnectNumMax=e.autoReconnectNumMax||0,this.autoReconnectNumTotal=0,this.autoReconnectInterval=e.autoReconnectInterval||0,this.context={status:_code.STATUS_INIT},this.apiUrl=e.apiUrl||"",this.sendQueue=new Queue,this.intervalId=null,this.orgName="",this.appName="",this.token=""}function _parsePrivacy(e){var t=[],o=e.getElementsByTagName("item");if(o)for(let e=0;e<o.length;e++){let n=o[e],i=n.getAttribute("value"),r=n.getAttribute("order"),s=n.getAttribute("type");if(!i)continue;let a=_parseNameFromJidFn(i);t[a]={type:s,order:r,jid:i,name:a}}return t}import StropheAll from"./libs/strophe";let WebIM={},Strophe=StropheAll.Strophe;Strophe.log=function(e,t){};let xmldom=require("./libs/xmldom/dom-parser"),DOMParser=xmldom.DOMParser,window={},_version="1.1.3",_code=require("./status").code,_utils=require("./utils").utils,_msg=require("./message"),_message=_msg._msg,_msgHash={},Queue=require("./queue").Queue,location=window.location||{protocol:"https:"};window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,window.XDomainRequest&&(XDomainRequest.prototype.oldsend=XDomainRequest.prototype.send,XDomainRequest.prototype.send=function(){XDomainRequest.prototype.oldsend.apply(this,arguments),this.readyState=2}),Strophe.Request.prototype._newXHR=function(){var e=_utils.xmlrequest(!0);return e.overrideMimeType&&e.overrideMimeType("text/xml"),e.onreadystatechange=this.func.bind(null,this),e},Strophe.Websocket.prototype._onSocketClose=function(e){},Strophe.Websocket.prototype._onMessage=function(e){var t,o;try{WebIM&&WebIM.config.isDebug&&(console.group("%crecv # ","color: green; font-size: large"),console.log("%c"+e.data,"color: green"),console.groupEnd())}catch(e){}if(0!==e.data.indexOf("<close ")){if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else o=this._streamWrap(e.data),t=(new DOMParser).parseFromString(o,"text/xml").documentElement;if(!this._check_streamerror(t,Strophe.Status.ERROR))return this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Strophe.serialize(t))):void this._conn._dataRecv(t,e.data)}else{t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement;let o=t.getAttribute("see-other-uri");o?(this._conn._changeConnectStatus(Strophe.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=o,this._connect()):this._conn._doDisconnect("receive <close> from server")}},connection.prototype.handelSendQueue=function(){var e=this.sendQueue.pop();null!==e&&this.sendReceiptsMessage(e)},connection.prototype.listen=function(e){e.url&&(this.url=_getXmppUrl(e.url,this.https)),this.onOpened=e.onOpened||_utils.emptyfn,this.onClosed=e.onClosed||_utils.emptyfn,this.onTextMessage=e.onTextMessage||_utils.emptyfn,this.onEmojiMessage=e.onEmojiMessage||_utils.emptyfn,this.onPictureMessage=e.onPictureMessage||_utils.emptyfn,this.onAudioMessage=e.onAudioMessage||_utils.emptyfn,this.onVideoMessage=e.onVideoMessage||_utils.emptyfn,this.onFileMessage=e.onFileMessage||_utils.emptyfn,this.onLocationMessage=e.onLocationMessage||_utils.emptyfn,this.onCmdMessage=e.onCmdMessage||_utils.emptyfn,this.onPresence=e.onPresence||_utils.emptyfn,this.onRoster=e.onRoster||_utils.emptyfn,this.onError=e.onError||_utils.emptyfn,this.onReceivedMessage=e.onReceivedMessage||_utils.emptyfn,this.onInviteMessage=e.onInviteMessage||_utils.emptyfn,this.onOffline=e.onOffline||_utils.emptyfn,this.onOnline=e.onOnline||_utils.emptyfn,this.onConfirmPop=e.onConfirmPop||_utils.emptyfn,this.onCreateGroup=e.onCreateGroup||_utils.emptyfn,this.onUpdateMyGroupList=e.onUpdateMyGroupList||_utils.emptyfn,this.onUpdateMyRoster=e.onUpdateMyRoster||_utils.emptyfn,this.onBlacklistUpdate=e.onBlacklistUpdate||_utils.emptyfn,_listenNetwork(this.onOnline,this.onOffline)},connection.prototype.heartBeatID=0,connection.prototype.heartBeat=function(){var e=this;this.stopHeartBeat(),this.heartBeatID=setInterval(function(){e.ping({toJid:e.domain,type:"normal"})},this.heartBeatWait)},connection.prototype.stopHeartBeat=function(){clearInterval(this.heartBeatID)},connection.prototype.sendReceiptsMessage=function(e){var t=StropheAll.$msg({from:this.context.jid||"",to:this.domain,id:e.id||""}).c("received",{xmlns:"urn:xmpp:receipts",id:e.id||""});this.sendCommand(t.tree())},connection.prototype.cacheReceiptsMessage=function(e){this.sendQueue.push(e)},connection.prototype.open=function(e){function t(e,t,i){n.context.status=_code.STATUS_DOLOGIN_IM,n.context.restTokenData=e,"404"!=e.statusCode&&"400"!=e.statusCode?_login(e.data,n):o({})}function o(e,t,o){n.clear(),e.error&&e.error_description?n.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:e,xhr:t}):n.onError({type:_code.WEBIM_CONNCTION_OPEN_ERROR,data:e,xhr:t})}let n=this;if(console.log("open",this.isOpening()),this.isOpening()||this.isOpened())console.log("can't open [1]");else if(_validCheck(e,this))if(e.accessToken)e.access_token=e.accessToken,this.token=e.access_token,_login(e,n);else{let n=e.apiUrl,i=e.user,r=e.pwd||"",s=e.appKey,a=s.split("#"),c=a[0],l=a[1];this.orgName=c,this.appName=l,this.context.status=_code.STATUS_DOLOGIN_USERGRID;let p={grant_type:"password",username:i,password:r,timestamp:+new Date},u=_utils.stringify(p);_utils.ajax({url:n+"/"+c+"/"+l+"/token",data:u,success:t||_utils.emptyfn,error:o||_utils.emptyfn})}else console.log("can't open [2]")},connection.prototype.attach=function(e){var t=this,o=_validCheck(e,this);if(!o)return;e=e||{};let n=e.accessToken||"";if(""==n)return void this.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR});let i=e.sid||"";if(""===i)return void this.onError({type:_code.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR});let r=e.rid||"";if(""===r)return void this.onError({type:_code.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR});let s=new Strophe.Connection(this.url,{inactivity:this.inactivity,maxRetries:this.maxRetries,pollingTime:this.pollingTime,heartBeatWait:this.heartBeatWait});this.context.accessToken=n,this.context.stropheConn=s,this.context.status=_code.STATUS_DOLOGIN_IM;let a=function(e,o){_loginCallback(e,o,t)},c=this.context.jid,l=this.wait,p=this.hold,u=this.wind||5;s.attach(c,i,r,a,l,p,u)},connection.prototype.close=function(e){let t=this.context.status;t!=_code.STATUS_INIT&&(this.isClosed()||this.isClosing()||(this.context.status=_code.STATUS_CLOSING,this.context.stropheConn.disconnect(e)))},connection.prototype.addHandler=function(e,t,o,n,i,r,s){this.context.stropheConn.addHandler(e,t,o,n,i,r,s)},connection.prototype.notifyVersion=function(e,t){var o=StropheAll.$iq({from:this.context.jid||"",to:this.domain,type:"result"}).c("query",{xmlns:"jabber:iq:version"}).c("name").t("easemob").up().c("version").t(_version).up().c("os").t("webim");e=e||_utils.emptyfn;let n=t||this.onError,i=function(e){n({type:_code.WEBIM_CONNCTION_NOTIFYVERSION_ERROR,data:e})};this.context.stropheConn.sendIQ(o.tree(),e,i)},connection.prototype.handlePresence=function(e){if(this.isClosed())return;let t=e.getAttribute("from")||"",o=e.getAttribute("to")||"",n=e.getAttribute("type")||"",i=e.getAttribute("presence_type")||"",r=_parseNameFromJidFn(t),s=_parseNameFromJidFn(o),a=!1,c=!1,l=!1,p=!1,u={from:r,to:s,fromJid:t,toJid:o,type:n,chatroom:!!e.getElementsByTagName("roomtype").length},d=e.getElementsByTagName("show");if(d&&d.length>0){let e=d[0];u.show=Strophe.getText(e)}let m=e.getElementsByTagName("status");if(m&&m.length>0){let e=m[0];u.status=Strophe.getText(e),u.code=e.getAttribute("code")}let h=e.getElementsByTagName("priority");if(h&&h.length>0){let e=h[0];u.priority=Strophe.getText(e)}let _=e.getElementsByTagName("error");_&&_.length>0&&(_=_[0],u.error={code:_.getAttribute("code")});let y=e.getElementsByTagName("destroy");if(y&&y.length>0){y=y[0],u.destroy=!0;let e=y.getElementsByTagName("reason");e&&e.length>0&&(u.reason=Strophe.getText(e[0]))}let g=e.getElementsByTagName("item");if(g&&g.length>0){let e=g[0],t=e.getAttribute("role"),o=e.getAttribute("jid"),n=e.getAttribute("affiliation");if("none"==t&&o){let t=_parseNameFromJidFn(o),n=e.getElementsByTagName("actor")[0],i=n.getAttribute("nick");u.actor=i,u.kicked=t}"moderator"==t&&"201"==u.code&&"owner"===n&&(u.type="createGroupACK",a=!0)}let f=e.getElementsByTagName("x");if(f&&f.length>0){let t=f[0].getElementsByTagName("apply"),o=f[0].getElementsByTagName("accept"),n=f[0].getElementsByTagName("item"),i=f[0].getElementsByTagName("decline"),r=f[0].getElementsByTagName("add_admin"),s=f[0].getElementsByTagName("remove_admin"),a=f[0].getElementsByTagName("add_mute"),d=f[0].getElementsByTagName("remove_mute");if(t&&t.length>0){p=!0,u.toNick=t[0].getAttribute("toNick"),u.type="joinGroupNotifications";let e=t[0].getAttribute("to"),o=e.split("@")[0].split("_");o=o[o.length-1],u.gid=o}else if(o&&o.length>0)u.type="joinPublicGroupSuccess";else if(n&&n.length>0){let t=n[0].getAttribute("affiliation"),o=n[0].getAttribute("role");if("member"==t||"participant"==o){c=!0,u.mid=u.fromJid.split("/"),u.mid=u.mid[u.mid.length-1],u.type="memberJoinPublicGroupSuccess";let t=e.getElementsByTagName("roomtype");if(t&&t.length>0){let e=t[0].getAttribute("type");"chatroom"==e&&(u.type="memberJoinChatRoomSuccess")}}else if("none"==t||"none"==o){let t=e.getElementsByTagName("roomtype");if(t&&t.length>0){let e=t[0].getAttribute("type");"chatroom"==e&&(u.type="memberLeaveChatRoomSuccess")}}}else if(i&&i.length){l=!0;let e=i[0].getAttribute("fromNick"),t=_parseNameFromJidFn(i[0].getAttribute("from"));u.type="joinPublicGroupDeclined",u.owner=t,u.gid=e}else if(r&&r.length>0){let e=_parseNameFromJidFn(r[0].getAttribute("mucjid")),t=_parseNameFromJidFn(r[0].getAttribute("from"));u.owner=t,u.gid=e,u.type="addAdmin"}else if(s&&s.length>0){let e=_parseNameFromJidFn(s[0].getAttribute("mucjid")),t=_parseNameFromJidFn(s[0].getAttribute("from"));u.owner=t,u.gid=e,u.type="removeAdmin"}else if(a&&a.length>0){let e=_parseNameFromJidFn(a[0].getAttribute("mucjid")),t=_parseNameFromJidFn(a[0].getAttribute("from"));u.owner=t,u.gid=e,u.type="addMute"}else if(d&&d.length>0){let e=_parseNameFromJidFn(d[0].getAttribute("mucjid")),t=_parseNameFromJidFn(d[0].getAttribute("from"));u.owner=t,u.gid=e,u.type="removeMute"}}if(u.chatroom){u.presence_type=i,u.original_type=u.type;let e=t.slice(t.lastIndexOf("/")+1);e===this.context.userId&&(""!==u.type||u.code?"unavailable"!==i&&"unavailable"!==u.type||(u.status?110==u.code?u.type="leaveChatRoom":u.error&&406==u.error.code&&(u.type="reachChatRoomCapacity"):u.type="leaveChatRoom"):u.type="joinChatRoomSuccess")}else if(u.presence_type=i,u.original_type=n,/subscribe/.test(u.type));else if(""!=n||u.status||u.error||a||p||c||l){if("unavailable"===i||"unavailable"===n)if(u.destroy)u.type="deleteGroupChat";else if(307==u.code||321==u.code){let t=e.getAttribute("nick");u.type=t?"removedFromGroup":"leaveGroup"}}else;this.onPresence(u,e)},connection.prototype.handleIq=function(e){return!0},connection.prototype.handleIqPrivacy=function(e){var t=e.getElementsByTagName("list");0!=t.length&&this.getBlacklist()},connection.prototype.handleIqRoster=function(e){var t=e.getAttribute("id"),o=e.getAttribute("from")||"",n=this.context.jid,i=StropheAll.$iq({type:"result",id:t,from:n});this.sendCommand(i.tree());let r=e.getElementsByTagName("query");if(r&&r.length>0){let e=r[0],t=_parseFriend(e,this,o);this.onRoster(t)}return!0},connection.prototype.handleMessage=function(e){if(this.isClosed())return;let t=e.getAttribute("id")||"";this.cacheReceiptsMessage({id:t});let o=_parseResponseMessage(e);if(o.errorMsg)return void this.handlePresence(e);let n=e.getElementsByTagName("error"),i="",r="",s=!1;if(n.length>0){s=!0,i=n[0].getAttribute("code");let e=n[0].getElementsByTagName("text");r=e[0].textContent||e[0].text}let a=o.data;for(let n in a){if(!Object.hasOwnProperty.call(a,n))continue;let c=a[n];if(!c.from||!c.to)continue;let l=(c.from+"").toLowerCase(),p=(c.to+"").toLowerCase(),u=c.ext||{},d="",m=e.getElementsByTagName("roomtype");d=m.length?m[0].getAttribute("type")||"chat":e.getAttribute("type")||"chat";let h=c.bodies;if(!h||0==h.length)continue;let _=c.bodies[0],y=_.type;try{switch(y){case"txt":let e=_.msg,n=_utils.parseTextMessage(e,WebIM.Emoji);if(n.isemoji){let e={id:t,type:d,from:l,to:p,delay:o.delayTimeStamp,data:n.body,ext:u};!e.delay&&delete e.delay,e.error=s,e.errorText=r,e.errorCode=i,this.onEmojiMessage(e)}else{let n={id:t,type:d,from:l,to:p,delay:o.delayTimeStamp,data:e,ext:u};!n.delay&&delete n.delay,n.error=s,n.errorText=r,n.errorCode=i,this.onTextMessage(n)}break;case"img":let a=0,c=0;_.size&&(a=_.size.width,c=_.size.height);let m={id:t,type:d,from:l,to:p,url:_.url,secret:_.secret,filename:_.filename,thumb:_.thumb,thumb_secret:_.thumb_secret,file_length:_.file_length||"",width:a,height:c,filetype:_.filetype||"",accessToken:this.context.accessToken||"",ext:u,delay:o.delayTimeStamp};!m.delay&&delete m.delay,m.error=s,m.errorText=r,m.errorCode=i,this.onPictureMessage(m);break;case"audio":m={id:t,type:d,from:l,to:p,url:_.url,secret:_.secret,filename:_.filename,length:_.length||"",file_length:_.file_length||"",filetype:_.filetype||"",accessToken:this.context.accessToken||"",ext:u,delay:o.delayTimeStamp},!m.delay&&delete m.delay,m.error=s,m.errorText=r,m.errorCode=i,this.onAudioMessage(m);break;case"file":m={id:t,type:d,from:l,to:p,url:_.url,secret:_.secret,filename:_.filename,file_length:_.file_length,accessToken:this.context.accessToken||"",ext:u,delay:o.delayTimeStamp},!m.delay&&delete m.delay,m.error=s,m.errorText=r,m.errorCode=i,this.onFileMessage(m);break;case"loc":m={id:t,type:d,from:l,to:p,addr:_.addr,lat:_.lat,lng:_.lng,ext:u,delay:o.delayTimeStamp},!m.delay&&delete m.delay,m.error=s,m.errorText=r,m.errorCode=i,this.onLocationMessage(m);break;case"video":m={id:t,type:d,from:l,to:p,url:_.url,secret:_.secret,filename:_.filename,file_length:_.file_length,accessToken:this.context.accessToken||"",ext:u,delay:o.delayTimeStamp},!m.delay&&delete m.delay,m.error=s,m.errorText=r,m.errorCode=i,this.onVideoMessage(m);break;case"cmd":m={id:t,from:l,to:p,action:_.action,ext:u,delay:o.delayTimeStamp},!m.delay&&delete m.delay,m.error=s,m.errorText=r,m.errorCode=i,this.onCmdMessage(m)}}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}}},connection.prototype.handleReceivedMessage=function(e){try{this.onReceivedMessage(e)}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}let t,o,n=e.getElementsByTagName("received");if(n.length>0&&(t=n[0].childNodes&&n[0].childNodes.length>0?n[0].childNodes[0].nodeValue:n[0].innerHTML||n[0].innerText,o=n[0].getAttribute("mid")),_msgHash[t]){try{_msgHash[t].msg.success instanceof Function&&_msgHash[t].msg.success(t,o)}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}delete _msgHash[t]}},connection.prototype.handleInviteMessage=function(e){var t=null,o=e.getElementsByTagName("invite"),n=e.getElementsByTagName("reason")[0],i=n.textContent,r=e.getAttribute("id")||"";if(this.sendReceiptsMessage({id:r}),o&&o.length>0){let e=o[0].getAttribute("from");t=_parseNameFromJidFn(e)}let s=e.getElementsByTagName("x"),a=null;if(s&&s.length>0)for(let e=0;e<s.length;e++)if("jabber:x:conference"===s[e].namespaceURI){let t=s[e].getAttribute("jid");a=_parseNameFromJidFn(t)}this.onInviteMessage({type:"invite",from:t,roomid:a,reason:i})},connection.prototype.sendCommand=function(e,t){this.isOpened()?this.context.stropheConn.send(e):this.onError({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.getUniqueId=function(e){var t=new Date,o=new Date(2010,1,1),n=t.getTime()-o.getTime(),i=parseInt(n).toString(16);return"string"==typeof e||"number"==typeof e?e+"_"+i:"WEBIM_"+i},connection.prototype.send=function(e){if(WebIM.config.isWindowSDK)WebIM.doQuery(JSON.stringify({type:"sendMessage",to:e.to,message_type:e.type,msg:encodeURI(e.msg),chatType:e.chatType}),function(e){},function(e,t){});else if("[object Object]"===Object.prototype.toString.call(e)){let t=this.context.appKey||"",o=t+"_"+e.to+"@"+this.domain;e.group&&(o=t+"_"+e.to+"@conference."+this.domain),e.resource&&(o=o+"/"+e.resource),e.toJid=o,e.id=e.id||this.getUniqueId(),_msgHash[e.id]=new _message(e),_msgHash[e.id].send(this)}else"string"==typeof e&&_msgHash[e]&&_msgHash[e].send(this)},connection.prototype.addRoster=function(e){var t=_getJid(e,this),o=e.name||"",n=e.groups||"",i=StropheAll.$iq({type:"set"});if(i.c("query",{xmlns:"jabber:iq:roster"}),i.c("item",{jid:t,name:o}),n)for(let e=0;e<n.length;e++)i.c("group").t(n[e]).up();let r=e.success||_utils.emptyfn,s=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(i.tree(),r,s)},connection.prototype.removeRoster=function(e){var t=_getJid(e,this),o=StropheAll.$iq({type:"set"}).c("query",{xmlns:"jabber:iq:roster"}).c("item",{jid:t,subscription:"remove"}),n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(o,n,i)},connection.prototype.getRoster=function(e){let t=StropheAll.$iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"});e=e||{};let o=e.success||this.onRoster,n=e.error||this.onError;this.isOpened()?this.context.stropheConn.sendIQ(t.tree(),function(e){var t=[],n=e.getElementsByTagName("query");if(n&&n.length>0){let e=n[0];t=_parseFriend(e)}o(t,e)},function(e){n({type:_code.WEBIM_CONNCTION_GETROSTER_ERROR,data:e})}):n({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.subscribe=function(e){var t=_getJid(e,this),o=StropheAll.$pres({to:t,type:"subscribe"});e.message&&o.c("status").t(e.message).up(),e.nick&&o.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(e.nick),this.sendCommand(o.tree())},connection.prototype.subscribed=function(e){var t=_getJid(e,this),o=StropheAll.$pres({to:t,type:"subscribed"});e.message&&o.c("status").t(e.message).up(),this.sendCommand(o.tree())},connection.prototype.unsubscribe=function(e){var t=_getJid(e,this),o=StropheAll.$pres({to:t,type:"unsubscribe"});e.message&&o.c("status").t(e.message),this.sendCommand(o.tree())},connection.prototype.unsubscribed=function(e){var t=_getJid(e,this),o=StropheAll.$pres({to:t,type:"unsubscribed"});e.message&&o.c("status").t(e.message).up(),this.sendCommand(o.tree())},connection.prototype.createRoom=function(e){var t,o=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn;return t=StropheAll.$iq({to:e.roomName,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this.context.stropheConn.sendIQ(t.tree(),o,n)},connection.prototype.listRooms=function(e){var t=StropheAll.$iq({to:e.server||"conference."+this.domain,from:this.context.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),o=e.success||_utils.emptyfn,n=e.error||this.onError,i=function(e){var t=[];t=_parseRoom(e);try{o(t)}catch(e){n({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:e})}},r=e.error||_utils.emptyfn,s=function(e){r({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:e})};this.context.stropheConn.sendIQ(t.tree(),i,s)},connection.prototype.queryRoomMember=function(e){var t=[],o=StropheAll.$iq({to:this.context.appKey+"_"+e.roomId+"@conference."+this.domain,type:"get"}).c("query",{xmlns:Strophe.NS.MUC+"#admin"}).c("item",{affiliation:"member"}),n=e.success||_utils.emptyfn,i=function(e){var o=e.getElementsByTagName("item");if(o)for(let e=0;e<o.length;e++){let n=o[e],i={jid:n.getAttribute("jid"),affiliation:"member"};t.push(i)}n(t)},r=e.error||_utils.emptyfn,s=function(e){r({type:_code.WEBIM_CONNCTION_GETROOMMEMBER_ERROR,data:e})};this.context.stropheConn.sendIQ(o.tree(),i,s)},connection.prototype.queryRoomInfo=function(e){var t=this.domain,o=StropheAll.$iq({to:this.context.appKey+"_"+e.roomId+"@conference."+t,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_INFO}),n=e.success||_utils.emptyfn,i=[],r=function(e){var o="",r=e.getElementsByTagName("feature");switch(r&&(o=r[1].getAttribute("var")+"|"+r[3].getAttribute("var")+"|"+r[4].getAttribute("var")),o){case"muc_public|muc_membersonly|muc_notallowinvites":o="PUBLIC_JOIN_APPROVAL";break;case"muc_public|muc_open|muc_notallowinvites":o="PUBLIC_JOIN_OPEN";break;case"muc_hidden|muc_membersonly|muc_allowinvites":o="PRIVATE_MEMBER_INVITE";break;case"muc_hidden|muc_membersonly|muc_notallowinvites":o="PRIVATE_OWNER_INVITE"}let s=e.getElementsByTagName("field"),a={};if(s){for(let e=0;e<s.length;e++){let o=s[e],n=o.getAttribute("var"),r=n.split("_")[1];switch(n){case"muc#roominfo_occupants":case"muc#roominfo_maxusers":case"muc#roominfo_affiliations":case"muc#roominfo_description":a[r]=o.textContent||o.text||"";break;case"muc#roominfo_owner":let e={jid:(o.textContent||o.text)+"@"+t,affiliation:"owner"};i.push(e),a[r]=o.textContent||o.text}}a.name=e.getElementsByTagName("identity")[0].getAttribute("name")}n(o,i,a)},s=e.error||_utils.emptyfn,a=function(e){s({type:_code.WEBIM_CONNCTION_GETROOMINFO_ERROR,data:e})};this.context.stropheConn.sendIQ(o.tree(),r,a)},connection.prototype.queryRoomOccupants=function(e){var t=e.success||_utils.emptyfn,o=function(e){var o=[];o=_parseRoomOccupants(e),t(o)},n=e.error||_utils.emptyfn,i=function(e){n({type:_code.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR,data:e})},r={xmlns:Strophe.NS.DISCO_ITEMS},s=StropheAll.$iq({from:this.context.jid,to:this.context.appKey+"_"+e.roomId+"@conference."+this.domain,type:"get"}).c("query",r);this.context.stropheConn.sendIQ(s.tree(),o,i)},connection.prototype.setUserSig=function(e){var t=StropheAll.$pres({xmlns:"jabber:client"});e=e||"",t.c("status").t(e),this.sendCommand(t.tree())},connection.prototype.setPresence=function(e,t){var o=StropheAll.$pres({xmlns:"jabber:client"});e&&(t?(o.c("show").t(e),o.up().c("status").t(t)):o.c("show").t(e)),this.sendCommand(o.tree())},connection.prototype.getPresence=function(){var e=StropheAll.$pres({xmlns:"jabber:client"});this.sendCommand(e.tree())},connection.prototype.ping=function(e){e=e||{};let t=_getJid(e,this),o=StropheAll.$iq({from:this.context.jid||"",to:t,type:"get"}).c("ping",{xmlns:"urn:xmpp:ping"}),n=e.success||_utils.emptyfn,i=e.error||this.onError,r=function(e){i({type:_code.WEBIM_CONNCTION_PING_ERROR,data:e})};this.isOpened()?this.context.stropheConn.sendIQ(o.tree(),n,r):i({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.isOpened=function(){return this.context.status==_code.STATUS_OPENED},connection.prototype.isOpening=function(){var e=this.context.status;return e==_code.STATUS_DOLOGIN_USERGRID||e==_code.STATUS_DOLOGIN_IM},connection.prototype.isClosing=function(){return this.context.status==_code.STATUS_CLOSING},connection.prototype.isClosed=function(){return this.context.status==_code.STATUS_CLOSED},connection.prototype.clear=function(){var e=this.context.appKey;this.errorType!=WebIM.statusCode.WEBIM_CONNCTION_DISCONNECTED&&(this.context={status:_code.STATUS_INIT,appKey:e}),this.intervalId&&clearInterval(this.intervalId),this.errorType==WebIM.statusCode.WEBIM_CONNCTION_CLIENT_LOGOUT||this.errorType},connection.prototype.getChatRooms=function(e){let t=this,o=e.accessToken||this.context.accessToken;if(o){let n=this.apiUrl,i=this.context.appName,r=this.context.orgName;if(!i||!r)return void t.onError({type:_code.WEBIM_CONNCTION_AUTH_ERROR});let s=function(t,o){"function"==typeof e.success&&e.success(t)},a=function(e,o,n){e.error&&e.error_description&&t.onError({type:_code.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,msg:e.error_description,data:e,xhr:o})},c={pagenum:parseInt(e.pagenum)||1,pagesize:parseInt(e.pagesize)||20},l={url:n+"/"+r+"/"+i+"/chatrooms",dataType:"json",type:"GET",header:{Authorization:"Bearer "+o},data:c,success:s||_utils.emptyfn,fail:a||_utils.emptyfn};wx.request(l)}else t.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR})},connection.prototype.joinChatRoom=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,o=t+"/"+this.context.userId,n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,r=function(e){i({type:_code.WEBIM_CONNCTION_JOINCHATROOM_ERROR,data:e})},s=StropheAll.$pres({from:this.context.jid,to:o});s.c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"member",role:"participant"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"}),this.context.stropheConn.sendIQ(s.tree(),n,r)},connection.prototype.quitChatRoom=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,o=t+"/"+this.context.userId,n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,r=function(e){i({type:_code.WEBIM_CONNCTION_QUITCHATROOM_ERROR,data:e})},s=StropheAll.$pres({from:this.context.jid,to:o,type:"unavailable"});s.c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"none",role:"none"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"}),this.context.stropheConn.sendIQ(s.tree(),n,r)},connection.prototype._onUpdateMyGroupList=function(e){this.onUpdateMyGroupList(e)},connection.prototype._onUpdateMyRoster=function(e){this.onUpdateMyRoster(e)},connection.prototype.listGroupMember=function(e){
if(isNaN(e.pageNum)||e.pageNum<=0)throw new Error('The parameter "pageNum" should be a positive number');if(isNaN(e.pageSize)||e.pageSize<=0)throw new Error('The parameter "pageSize" should be a positive number');if(null===e.groupId&&void 0===e.groupId)throw new Error('The parameter "groupId" should be added');let t=[],o=e.groupId;t.pagenum=e.pageNum,t.pagesize=e.pageSize;let n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+o+"/users",dataType:"json",type:"GET",data:t,headers:{Authorization:"Bearer "+this.context.accessToken,"Content-Type":"application/json"}};n.success=e.success||_utils.emptyfn,n.error=e.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.createGroupNew=function(e){e.data.invite_need_confirm=!1;let t={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups",dataType:"json",type:"POST",data:JSON.stringify(e.data),headers:{Authorization:"Bearer "+this.context.accessToken,"Content-Type":"application/json"}};t.success=function(t){e.success(t),this.onCreateGroup(t)}.bind(this),t.error=e.error||_utils.emptyfn,WebIM.utils.ajax(t)},connection.prototype.getGroupInfo=function(e){var t={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e.groupId,type:"GET",dataType:"json",headers:{Authorization:"Bearer "+this.context.accessToken,"Content-Type":"application/json"}};t.success=e.success||_utils.emptyfn,t.error=e.error||_utils.emptyfn,WebIM.utils.ajax(t)},connection.prototype.dissolveGroup=function(e){var t=e.groupId,o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"?version=v3",type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.context.accessToken,"Content-Type":"application/json"}};o.success=e.success||_utils.emptyfn,o.error=e.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.getBlacklist=function(e){e=e||{};let t=StropheAll.$iq({type:"get"}),o=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,i=this;t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),this.context.stropheConn.sendIQ(t.tree(),function(e){i.onBlacklistUpdate(_parsePrivacy(e)),o()},function(){i.onBlacklistUpdate([]),n()})},connection.prototype.addToBlackList=function(e){var t=StropheAll.$iq({type:"set"}),o=e.list||{},n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,r=t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),s=Object.keys(o),a=s.length,c=2;for(let e=0;e<a;e++){let t=o[s[e]],n=t.type||"jid",i=t.jid;r=r.c("item",{action:"deny",order:c++,type:n,value:i}).c("message"),e!==a-1&&(r=r.up().up())}this.context.stropheConn.sendIQ(r.tree(),n,i)},connection.prototype.removeFromBlackList=function(e){var t=StropheAll.$iq({type:"set"}),o=e.list||{},n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,r=t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),s=Object.keys(o),a=s.length;for(let e=0;e<a;e++){let t=o[s[e]],n=t.type||"jid",i=t.jid,c=t.order;r=r.c("item",{action:"deny",order:c,type:n,value:i}).c("message"),e!==a-1&&(r=r.up().up())}this.context.stropheConn.sendIQ(r.tree(),n,i)},connection.prototype._getGroupJid=function(e){var t=this.context.appKey||"";return t+"_"+e+"@conference."+this.domain},connection.prototype.addToGroupBlackList=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=_getJid(e,this),i="admin",r=this._getGroupJid(e.roomId),s=StropheAll.$iq({type:"set",to:r});s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}).c("item",{affiliation:"outcast",jid:n}),this.context.stropheConn.sendIQ(s.tree(),t,o)},connection.prototype.getGroupBlacklist=function(e){function t(e){var t={},o=e.getElementsByTagName("item");if(o)for(let e=0;e<o.length;e++){let n=o[e],i=n.getAttribute("jid"),r=n.getAttribute("affiliation"),s=n.getAttribute("nick");if(!i)continue;let a=_parseNameFromJidFn(i);t[a]={jid:i,affiliation:r,nick:s,name:a}}return t}var o=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,i="admin",r=this._getGroupJid(e.roomId),s=StropheAll.$iq({type:"get",to:r});s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}).c("item",{affiliation:"outcast"}),this.context.stropheConn.sendIQ(s.tree(),function(e){o(t(e))},function(){n()})},connection.prototype.removeGroupMemberFromBlacklist=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=_getJid(e,this),i="admin",r=this._getGroupJid(e.roomId),s=StropheAll.$iq({type:"set",to:r});s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}).c("item",{affiliation:"member",jid:n}),this.context.stropheConn.sendIQ(s.tree(),function(e){t()},function(){o()})},connection.prototype.changeGroupSubject=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n="owner",i=this._getGroupJid(e.roomId),r=StropheAll.$iq({type:"set",to:i});r.c("query",{xmlns:"http://jabber.org/protocol/muc#"+n}).c("x",{type:"submit",xmlns:"jabber:x:data"}).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up().c("field",{var:"muc#roomconfig_roomname"}).c("value").t(e.subject).up().up().c("field",{var:"muc#roomconfig_roomdesc"}).c("value").t(e.description),this.context.stropheConn.sendIQ(r.tree(),function(e){t()},function(){o()})},connection.prototype.destroyGroup=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n="owner",i=this._getGroupJid(e.roomId),r=StropheAll.$iq({type:"set",to:i});r.c("query",{xmlns:"http://jabber.org/protocol/muc#"+n}).c("destroy"),this.context.stropheConn.sendIQ(r.tree(),function(e){t()},function(){o()})},connection.prototype.leaveGroupBySelf=function(e){var t=this,o=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,i=_getJid(e,this),r="admin",s=this._getGroupJid(e.roomId),a=StropheAll.$iq({type:"set",to:s});a.c("query",{xmlns:"http://jabber.org/protocol/muc#"+r}).c("item",{affiliation:"none",jid:i}),this.context.stropheConn.sendIQ(a.tree(),function(e){o(e);let n=StropheAll.$pres({type:"unavailable",to:s+"/"+t.context.userId});t.sendCommand(n.tree())},function(e){n(e)})},connection.prototype.addGroupMembers=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=e.list||[],i="admin",r=this._getGroupJid(e.roomId),s=StropheAll.$iq({type:"set",to:r}),a=s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}),c=n.length;for(let t=0;t<c;t++){let o=n[t],i=_getJidByName(o,this);a=a.c("item",{affiliation:"member",jid:i}).up();let s=StropheAll.$msg({to:r}).c("x",{xmlns:"http://jabber.org/protocol/muc#user"}).c("invite",{to:i}).c("reason").t(e.reason||"");this.sendCommand(s.tree())}this.context.stropheConn.sendIQ(s.tree(),function(e){t(e)},function(e){o(e)})},connection.prototype.acceptInviteFromGroup=function(e){e.success=function(){},this.addGroupMembers(e)},connection.prototype.rejectInviteFromGroup=function(e){},WebIM.connection=connection,WebIM.utils=_utils,WebIM.statusCode=_code,WebIM.message=_msg.message,WebIM.doQuery=function(e,t,o){void 0!==window.cefQuery&&window.cefQuery({request:e,persistent:!1,onSuccess:t,onFailure:o})},module.exports=WebIM,module.hot&&module.hot.accept();